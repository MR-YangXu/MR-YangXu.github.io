import{_ as e,r as i,o as l,c,b as s,d as a,e as p,a as o}from"./app.6d6c724e.js";const u={},r={class:"custom-container tip"},k={href:"https://github.com/kangyana/daily-question/issues/109",target:"_blank",rel:"noopener noreferrer"},d={class:"custom-container tip"},m={href:"https://github.com/kangyana",target:"_blank",rel:"noopener noreferrer"},v={href:"https://github.com/jantimon/html-webpack-plugin",target:"_blank",rel:"noopener noreferrer"},b={href:"https://github.com/rollup/plugins/tree/master/packages/html",target:"_blank",rel:"noopener noreferrer"},g={href:"https://github.com/shfshanyue/mini-code/tree/master/code/html-webpack-plugin",target:"_blank",rel:"noopener noreferrer"};function f(y,n){const t=i("ExternalLinkIcon");return l(),c("div",null,[n[20]||(n[20]=s("h1",{id:"\u3010q109\u3011\u6253\u5305\u5668-\u5982\u4F55\u5C06\u6253\u5305\u540E\u7684-js-\u8D44\u6E90\u6CE8\u5165-html-\u4E2D",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#\u3010q109\u3011\u6253\u5305\u5668-\u5982\u4F55\u5C06\u6253\u5305\u540E\u7684-js-\u8D44\u6E90\u6CE8\u5165-html-\u4E2D","aria-hidden":"true"},"#"),a(" \u3010Q109\u3011\u6253\u5305\u5668 \u5982\u4F55\u5C06\u6253\u5305\u540E\u7684 js \u8D44\u6E90\u6CE8\u5165 html \u4E2D")],-1)),s("div",r,[n[2]||(n[2]=s("p",{class:"custom-container-title"},"Issue",-1)),s("p",null,[n[1]||(n[1]=a("\u6B22\u8FCE\u5728 Gtihub Issue \u4E2D\u56DE\u7B54\u6B64\u95EE\u9898: ")),s("a",k,[n[0]||(n[0]=a("Issue 109")),p(t)])])]),s("div",d,[n[5]||(n[5]=s("p",{class:"custom-container-title"},"Author",-1)),s("p",null,[n[4]||(n[4]=a("\u56DE\u7B54\u8005: ")),s("a",m,[n[3]||(n[3]=a("kangyana")),p(t)])])]),n[21]||(n[21]=o(`<p>\u5982\u679C\u6700\u7EC8\u6253\u5305\u751F\u6210\u7684 <code>main.js</code> \u65E2\u6CA1\u6709\u505A code spliting\uFF0C\u4E5F\u6CA1\u6709\u505A <code>hash</code> \u5316\u8DEF\u5F84\u3002 \u5927\u53EF\u4EE5\u901A\u8FC7\u5728 <code>index.html</code> \u4E2D\u624B\u52A8\u63A7\u5236 JS \u8D44\u6E90\u3002</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;main.js&quot;</span> defer <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4F46\u5F80\u5F80\u4E8B\u4E0E\u613F\u8FDD\uFF1A</p><ul><li><code>main.js</code> \u5373\u6211\u4EEC\u6700\u7EC8\u751F\u6210\u7684\u6587\u4EF6\u5E26\u6709 <code>hash</code> \u503C\uFF0C\u5982 <code>main.8a9b3c.js</code>\u3002</li><li>\u7531\u4E8E\u957F\u671F\u7F13\u5B58\u4F18\u5316\u7684\u9700\u8981\uFF0C\u5165\u53E3\u6587\u4EF6\u4E0D\u4EC5\u53EA\u6709\u4E00\u4E2A\uFF0C\u8FD8\u5305\u62EC\u7531\u7B2C\u4E09\u65B9\u6A21\u5757\u6253\u5305\u800C\u6210\u7684 <code>verdor.js</code>\uFF0C\u540C\u6837\u5E26\u6709 <code>hash</code>\u3002</li><li>\u811A\u672C\u5730\u5740\u540C\u65F6\u9700\u8981\u6CE8\u5165 <code>publicPath</code>\uFF0C\u800C\u5728\u751F\u4EA7\u73AF\u5883\u4E0E\u6D4B\u8BD5\u73AF\u5883\u7684 <code>publicPath</code> \u5E76\u4E0D\u4E00\u81F4\u3002</li></ul>`,4)),s("p",null,[n[8]||(n[8]=a("\u56E0\u6B64\u9700\u8981\u6709\u4E00\u4E2A\u63D2\u4EF6\u81EA\u52A8\u505A\u8FD9\u79CD\u4E8B\u60C5\u3002\u5728 webpack \u7684\u4E16\u754C\u91CC\uFF0C\u5B83\u662F ")),s("a",v,[n[6]||(n[6]=a("html-webpak-plugin (opens new window)")),p(t)]),n[9]||(n[9]=a("\uFF0C \u5728 rollup \u7684\u4E16\u754C\u91CC\uFF0C\u5B83\u662F ")),s("a",b,[n[7]||(n[7]=a("@rollup/plugin-html (opens new window)")),p(t)]),n[10]||(n[10]=a("\u3002"))]),n[22]||(n[22]=s("h3",{id:"\u800C\u6CE8\u5165\u7684\u539F\u7406\u4E3A\u5F53\u6253\u5305\u5668\u5DF2\u751F\u6210-entrypoint-\u6587\u4EF6\u8D44\u6E90\u540E-\u83B7\u5F97\u5176\u6587\u4EF6\u540D\u53CA-publicpath-\u5E76\u5C06\u5176\u6CE8\u5165\u5230-html-\u4E2D\u3002",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#\u800C\u6CE8\u5165\u7684\u539F\u7406\u4E3A\u5F53\u6253\u5305\u5668\u5DF2\u751F\u6210-entrypoint-\u6587\u4EF6\u8D44\u6E90\u540E-\u83B7\u5F97\u5176\u6587\u4EF6\u540D\u53CA-publicpath-\u5E76\u5C06\u5176\u6CE8\u5165\u5230-html-\u4E2D\u3002","aria-hidden":"true"},"#"),a(" \u800C\u6CE8\u5165\u7684\u539F\u7406\u4E3A\u5F53\u6253\u5305\u5668\u5DF2\u751F\u6210 entryPoint \u6587\u4EF6\u8D44\u6E90\u540E\uFF0C\u83B7\u5F97\u5176\u6587\u4EF6\u540D\u53CA "),s("code",null,"publicPath"),a("\uFF0C\u5E76\u5C06\u5176\u6CE8\u5165\u5230 html \u4E2D\u3002")],-1)),s("p",null,[n[12]||(n[12]=a("\u4EE5 ")),n[13]||(n[13]=s("code",null,"html-webpack-plugin",-1)),n[14]||(n[14]=a(" \u4E3A\u4F8B\uFF0C\u5B83\u5728 ")),n[15]||(n[15]=s("code",null,"compilation",-1)),n[16]||(n[16]=a(" \u5904\u7406\u8D44\u6E90\u7684 ")),n[17]||(n[17]=s("code",null,"processAssets",-1)),n[18]||(n[18]=a(" \u83B7\u5F97\u5176\u6253\u5305\u751F\u6210\u7684\u8D44\u6E90\u3002 \u6700\u5C0F\u5B9E\u73B0\u5982\u4E0B\uFF0C\u53EF\u5728 ")),s("a",g,[n[11]||(n[11]=a("mini-node:html-webpack-plugin (opens new window)")),p(t)]),n[19]||(n[19]=a("\u83B7\u5F97\u6E90\u7801\u5E76\u8FD0\u884C\u793A\u4F8B\u3002"))]),n[23]||(n[23]=o(`<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">HtmlWebpackPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> webpack <span class="token operator">=</span> compiler<span class="token punctuation">.</span>webpack<span class="token punctuation">;</span>

    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>thisCompilation<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;HtmlWebpackPlugin&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// compilation \u662F webpack \u4E2D\u6700\u91CD\u8981\u7684\u5BF9\u8C61\uFF0C\u6587\u6863\u89C1 [compilation-object](https://webpack.js.org/api/compilation-object/#compilation-object-methods)</span>

      compilation<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>processAssets<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;HtmlWebpackPlugin&quot;</span><span class="token punctuation">,</span>

          <span class="token comment">// processAssets \u5904\u7406\u8D44\u6E90\u7684\u65F6\u673A\uFF0C\u6B64\u9636\u6BB5\u4E3A\u8D44\u6E90\u5DF2\u4F18\u5316\u540E\uFF0C\u66F4\u591A\u9636\u6BB5\u89C1\u6587\u6863</span>
          <span class="token comment">// https://webpack.js.org/api/compilation-hooks/#list-of-asset-processing-stages</span>
          <span class="token literal-property property">stage</span><span class="token operator">:</span> webpack<span class="token punctuation">.</span>Compilation<span class="token punctuation">.</span><span class="token constant">PROCESS_ASSETS_STAGE_OPTIMIZE_INLINE</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token parameter">compilationAssets<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// compilationAssets \u5C06\u5F97\u5230\u6240\u6709\u751F\u6210\u7684\u8D44\u6E90\uFF0C\u5982\u5404\u4E2A chunk.js\u3001\u5404\u4E2A image\u3001css</span>

          <span class="token comment">// \u83B7\u53D6 webpac.output.publicPath \u9009\u9879\uFF0C(PS: publicPath \u9009\u9879\u6709\u53EF\u80FD\u662F\u901A\u8FC7\u51FD\u6570\u8BBE\u7F6E)</span>
          <span class="token keyword">const</span> publicPath <span class="token operator">=</span> <span class="token function">getPublicPath</span><span class="token punctuation">(</span>compilation<span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// \u672C\u793A\u4F8B\u4EC5\u4EC5\u8003\u8651\u5355\u4E2A entryPoint \u7684\u60C5\u51B5</span>
          <span class="token comment">// compilation.entrypoints \u53EF\u83B7\u53D6\u5165\u53E3\u6587\u4EF6\u4FE1\u606F</span>
          <span class="token keyword">const</span> entryNames <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>compilation<span class="token punctuation">.</span>entrypoints<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// entryPoint.getFiles() \u5C06\u83B7\u53D6\u5230\u8BE5\u5165\u53E3\u7684\u6240\u6709\u8D44\u6E90\uFF0C\u5E76\u80FD\u591F\u4FDD\u8BC1\u52A0\u8F7D\u987A\u5E8F\uFF01\uFF01\uFF01\u5982 runtime-chunk -&gt; main-chunk</span>
          <span class="token keyword">const</span> assets <span class="token operator">=</span> entryNames
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entryName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
              compilation<span class="token punctuation">.</span>entrypoints<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>entryName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> scripts <span class="token operator">=</span> assets<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">src</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> publicPath <span class="token operator">+</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>title <span class="token operator">||</span> <span class="token string">&quot;Demo&quot;</span><span class="token punctuation">,</span>
            scripts<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// emitAsset \u7528\u4EE5\u751F\u6210\u8D44\u6E90\u6587\u4EF6\uFF0C\u4E5F\u662F\u6700\u91CD\u8981\u7684\u4E00\u6B65</span>
          compilation<span class="token punctuation">.</span><span class="token function">emitAsset</span><span class="token punctuation">(</span>
            <span class="token string">&quot;index.html&quot;</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>sources<span class="token punctuation">.</span>RawSource</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1))])}const w=e(u,[["render",f],["__file","109.html.vue"]]);export{w as default};
